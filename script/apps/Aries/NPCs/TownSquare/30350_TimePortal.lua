--[[
Title: TimePortal
Author(s): Leio
Date: 2010/02/01

use the lib:
------------------------------------------------------------
script/apps/Aries/NPCs/TownSquare/30350_TimePortal.lua
------------------------------------------------------------
]]

-- create class
local libName = "TimePortal";

local TimePortal = {
	--homes = {
		--113829210,106982298,
	--},
	homes = {
		6171375
,117255713
,68052465
,83963070
,66697355
,69573465
,8987737
,48195770
,18155938
,52910251
,14193532
,7291839
,36174151
,68275271
,3910167
,3889116
,19891852
,97698913
,98776630
,5143910
,64871928
,82065827
,32089681
,35864642
,94162537
,95838966
,31557504
,15820779
,35487067
,5958004
,499282
,82065827
,5646676
,2991661
,5070462
,88772688
,103831404
,115499014
,44999314
,61520824
,2599314
,1683844
,6786360
,48195770
,2994397
,53809262
,123506
,82544675
,6078301
,19042368
,50833563
,16254254
,82065827
,6582896
,108389343
,59095250
,636671
,68867984
,90506601
,6634164
,109165214
,3592469
,48478193
,49584856
,110848178
,16302615
,33561174
,44210408
,32969620
,33488421
,3574035
,7989642
,104661276
,636671
,32962047
,63342194
,91913390
,1190979
,4461598
,7146510
,7493008
,102817370
,41992219
,56487489
,5725548
,45714933
,49197097
,8194221
,48195770
,3144809
,109165214
,89976197
,122879048
,117079287
,108837966
,6634164
,118214464
,4461598
,71819250
,110546124
,8194221
,129939374
,11705533
,51765599
,7493008
,41603275
,6209140
,262751
,99930986
,12957261
,113782662
,5052217
,13100825
,263667
,5725548
,130598466
,5725548
,147335926
,41289155
,109165214
,30978962
,5052217
,13100825
,263667
,43633076
,44041323
,89524934
,117958850
,64303381
,12998530
,76565510
,10309820
,16302615
,1054955
,76294510
,36297541
,32990101
,48204713
,109857438
,32990101
,102533412
,8811800
,110546124
,40153403
,109857438
,129939374
,12774589
,54597671
,140877138
,2661925
,1054955
,46850746
,16302615
,36297541
,9829259
,117079287
,1228345
,65662820
,133053458
,46977017
,82544675
--2010-05-14
,1228345,41094319,46850746,44041323,46850746,109165214,140019565,146912801,41289155,117079287
,13119994
,111520551
,1054955
,41603275
,102229296
,13883362
,1054955
,56892891
,7549150
,149536886
,1054955
,66166262
,10309820
,1054955
,66166262
,34960756
,90959155
,99930986
,66166262
,16302615
,133053458
,38672685
,133053458
,38672685
,40153403
,109165214
,123539107
,17094793
,123539107
,46850746
--2010-08-20
,90748514,109857438,137223993,1054955,16738315,90748514,50521600,1054955,117079287,90748514,101577814,
	}
};
commonlib.setfield("MyCompany.Aries.Quest.NPCs.TimePortal", TimePortal);

local Quest = MyCompany.Aries.Quest;
local GameObject = MyCompany.Aries.Quest.GameObject;
local NPC = MyCompany.Aries.Quest.NPC;

local ItemManager = System.Item.ItemManager;
local hasGSItem = ItemManager.IfOwnGSItem;
local equipGSItem = ItemManager.IfEquipGSItem;

-- TimePortal.main
function TimePortal.main()
	local self = TimePortal;
	self.send = false;
end
function TimePortal.PreDialog(npc_id, instance)
	return false;
end
function TimePortal.On_Timer()
	local npc = NPC.GetNpcCharacterFromIDAndInstance(30350);
	local player = ParaScene.GetPlayer();
	if(npc and npc:IsValid() and player:IsValid()) then
		local dist = npc:DistanceTo(player);
		if(dist <= 5) then
			 MyCompany.Aries.Quest.NPCs.TimePortal.GoHome();
		end
	end
end
function TimePortal.GoHome()
	local self = TimePortal;
	local len = #self.homes;
	local index = math.random(len);
	local homeid = self.homes[index];
	commonlib.echo("========homeid");
	commonlib.echo(homeid);
	if(homeid)then
		if(not self.send)then
			self.send = true;
			NPL.load("(gl)script/kids/3DMapSystemUI/HomeLand/HomeLandGateway.lua");
			Map3DSystem.App.HomeLand.HomeLandGateway.Gohome(homeid);
		end
	end
end
